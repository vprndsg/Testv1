<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>Psychedelic Simon</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
      overflow: hidden;
      font-family: Arial, Helvetica, sans-serif;
    }
    body {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #game {
      position: relative;
      width: 100vw;
      height: 100vh;
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr 1fr;
    }
    .pad {
      margin: 2vw;
      background: #ff0080;
      border-radius: 50%;
      position: relative;
      overflow: hidden;
      animation: morph 4s ease-in-out infinite alternate,
                 hue 5s linear infinite,
                 float 6s ease-in-out infinite;
      display: flex;
      align-items: center;
      justify-content: center;
      touch-action: manipulation;
    }
    .pad::before {
      content: "";
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.3), rgba(255,255,255,0) 70%);
      animation: move 4s linear infinite alternate;
    }
    .pad.active {
      box-shadow: 0 0 40px rgba(255,255,255,0.7);
      transform: scale(1.3);
      filter: brightness(1.5);
    }
    @keyframes morph {
      0% {
        border-radius: 70% 30% 80% 20% / 70% 20% 80% 30%;
      }
      50% {
        border-radius: 30% 70% 20% 80% / 20% 80% 30% 70%;
      }
      100% {
        border-radius: 70% 30% 80% 20% / 70% 20% 80% 30%;
      }
    }
    @keyframes hue {
      from { filter: hue-rotate(0deg); }
      to { filter: hue-rotate(360deg); }
    }
    @keyframes move {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    #overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      font-size: 5vw;
      z-index: 10;
    }
    #overlay button {
      margin-top: 2vh;
      padding: 1vh 2vh;
      font-size: 4vw;
      background: #fff;
      color: #000;
      border: none;
      border-radius: 10px;
    }
    body::before {
      content: "";
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: radial-gradient(circle at top left, #ff00cc, #333);
      animation: bgHue 10s linear infinite alternate;
      z-index: -1;
    }
    @keyframes bgHue {
      0% { filter: hue-rotate(0deg) saturate(1); }
      100% { filter: hue-rotate(360deg) saturate(1.5); }
    }

    @keyframes float {
      0%   { top: 0; left: 0; }
      25%  { top: -6%; left: 3%; }
      50%  { top: 6%; left: -2%; }
      75%  { top: -4%; left: -3%; }
      100% { top: 0; left: 0; }
    }
  </style>
</head>
<body>
  <div id="game">
    <div class="pad" data-pad="0" style="background:#ff0066;"></div>
    <div class="pad" data-pad="1" style="background:#00c3ff;"></div>
    <div class="pad" data-pad="2" style="background:#ffee00;"></div>
    <div class="pad" data-pad="3" style="background:#00ff99;"></div>
    <div id="overlay"><div>Tap to Start</div><button id="start">Start</button></div>
  </div>
  <script>
    const pads = document.querySelectorAll('.pad');
    const overlay = document.getElementById('overlay');
    const startBtn = document.getElementById('start');
    let sequence = [];
    let playerIndex = 0;
    let playing = false;
    let ctx;

    const freqs = [261.6, 329.6, 392.0, 523.3];

    function playTone(index) {
      if (!ctx) return;
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = 'sine';
      osc.frequency.value = freqs[index];
      osc.connect(gain);
      gain.connect(ctx.destination);
      gain.gain.setValueAtTime(0.0001, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.4, ctx.currentTime + 0.01);
      osc.start();
      gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.5);
      osc.stop(ctx.currentTime + 0.55);
    }

    function flashPad(index) {
      const pad = pads[index];
      pad.classList.add('active');
      playTone(index);
      setTimeout(() => pad.classList.remove('active'), 500);
    }

    async function showSequence() {
      playing = true;
      let delay = Math.max(600 - sequence.length * 20, 200);
      for (const index of sequence) {
        await new Promise(res => setTimeout(res, delay));
        flashPad(index);
        await new Promise(res => setTimeout(res, 300));
      }
      playing = false;
    }

    function nextRound() {
      sequence.push(Math.floor(Math.random() * 4));
      playerIndex = 0;
      showSequence();
    }

    function endGame() {
      overlay.innerHTML = `<div>Game Over<br>Score: ${sequence.length - 1}</div><button id="start">Restart</button>`;
      overlay.style.display = 'flex';
      sequence = [];
    }

    function startGame() {
      if (!ctx) ctx = new (window.AudioContext || window.webkitAudioContext)();
      overlay.style.display = 'none';
      sequence = [];
      nextRound();
    }

    pads.forEach(pad => {
      pad.addEventListener('pointerdown', e => {
        if (playing || overlay.style.display !== 'none') return;
        const idx = parseInt(pad.dataset.pad, 10);
        flashPad(idx);
        if (idx === sequence[playerIndex]) {
          playerIndex++;
          if (playerIndex === sequence.length) {
            setTimeout(nextRound, 600);
          }
        } else {
          endGame();
        }
      });
    });

    overlay.addEventListener('click', e => {
      if (e.target.id === 'start') startGame();
    });
  </script>
</body>
</html>
